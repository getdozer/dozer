syntax = "proto3";

package dozer.internal;

service InternalPipelineService {
  rpc DescribeStorage(StorageRequest) returns (StorageResponse);
  /// For every `LogRequest` sent, the server will reply one `LogResponse`.
  rpc GetLog(stream LogRequest) returns (stream LogResponse);
}

message StorageRequest {
  string endpoint = 1;
}

message LocalStorage {
  string root = 1;
}

message S3Storage {
  string bucket_name = 1;
}

message StorageResponse {
  oneof storage {
    LocalStorage local = 1;
    S3Storage s3 = 2;
  };
}

message LogRequest {
  /// The endpoint name.
  string endpoint = 1;
  /// [start, end) interval.
  uint64 start = 2;
  /// [start, end) interval.
  uint64 end = 3;
  /// Send back any data that's available within the timeout, unless there's no data available.
  uint32 timeout_in_millis = 4;
}

message LogResponse {
  /// This is the bincode serialzied `LogResponse` struct.
  ///
  /// It's a dirty way to make things work quickly. We'll properly define the protobuf message later.
  bytes data = 1;
}
